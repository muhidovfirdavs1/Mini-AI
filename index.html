<!doctype html>
<html lang="uz">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MiniAI</title>
<meta name="description" content="MiniAI ‚Äî oddiy, offline va responsive chatbot. Deploy qiling: GitHub Pages yoki Netlify bilan HTTPS avtomatik." />
<!-- üîπ Favicon (brauzer oynasida ko‚Äòrinadi) -->
<link rel="icon" type="image/png" sizes="32x32" href="logo.png">
<link rel="icon" type="image/png" sizes="16x16" href="logo.png">

<!-- üîπ Apple iPhone / iPad uchun -->
<link rel="apple-touch-icon" sizes="180x180" href="logo.png">

<!-- üîπ Microsoft / Android uchun (ixtiyoriy) -->
<meta name="msapplication-TileImage" content="logo.png">
<meta name="msapplication-TileColor" content="#0f4a7d">

<!-- üîπ SEO uchun tavsiya -->
<meta name="description" content="MiniAI ‚Äî Sizning shaxsiy AI yordamchingiz.">
<style>
  /* ====== GLOBAL ====== */
  :root{
    --bg:#071129;
    --card:#0c1724;
    --muted:#9fb1c9;
    --accent:#60a5fa;
    --accent-2:#8b5cf6;
    --glass: rgba(255,255,255,0.03);
    --text:#e6eef8;
    --success:#4ade80;
    --danger:#fb7185;
    --radius:14px;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Roboto,"Helvetica Neue",Arial;color:var(--text);background:linear-gradient(180deg,var(--bg),#041022);}
  a{color:var(--accent)}
  /* ====== LAYOUT ====== */
  .wrap{max-width:1100px;margin:28px auto;padding:18px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));box-shadow:0 12px 40px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.02);overflow:hidden}
  header{display:flex;align-items:center;gap:12px;padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.02)}
  .logo{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;color:#051022;font-size:18px}
  header h1{margin:0;font-size:18px}
  header p{margin:0;color:var(--muted);font-size:13px}

  main{display:flex;gap:18px;padding:18px}
  .chat{flex:1;display:flex;flex-direction:column;min-height:420px}
  .messages{flex:1;padding:12px;display:flex;flex-direction:column;gap:12px;overflow:auto}
  .msg{max-width:78%;padding:12px 14px;border-radius:12px;line-height:1.45;white-space:pre-wrap;word-wrap:break-word}
  .user{align-self:flex-end;background:linear-gradient(180deg,#071827,#051423);border:1px solid rgba(255,255,255,0.02)}
  .bot{align-self:flex-start;background:var(--glass);border:1px solid rgba(255,255,255,0.02)}
  .meta-badge{font-size:12px;color:var(--muted);margin-top:6px}
  .controls{display:flex;gap:10px;padding-top:10px}
  input[type="text"]{flex:1;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:#061124;color:var(--text);outline:none;font-size:15px}
  button{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#021028;cursor:pointer;font-weight:700}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);font-weight:600}

  /* SIDEBAR */
  aside{width:340px;border-left:1px solid rgba(255,255,255,0.02);padding-left:18px;display:flex;flex-direction:column}
  .section-title{font-size:13px;color:var(--muted);margin-bottom:8px}
  .qa-list{display:flex;flex-direction:column;gap:8px;max-height:38vh;overflow:auto;padding-right:6px}
  .qa-item{background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.01);font-size:14px;color:var(--text);display:flex;justify-content:space-between;align-items:center;gap:8px}
  .qa-item .q{font-weight:600}
  .qa-item .a{font-size:13px;color:var(--muted);max-width:170px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap}
  textarea, select{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);background:#061124;color:var(--text);resize:vertical}
  .small{font-size:13px;color:var(--muted)}
  .footer-actions{display:flex;gap:8px;margin-top:12px}

  /* RESPONSIVE */
  @media (max-width:980px){
    main{flex-direction:column}
    aside{width:100%;border-left:none;padding-left:0;border-top:1px solid rgba(255,255,255,0.02);margin-top:12px}
  }

  /* tiny helpers */
  .hint{font-size:13px;color:var(--muted);margin-top:8px}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="MiniAI Chat">
    <header>
      <div class="logo">AI</div>
      <div>
        <h1>MiniAI</h1>
        <p>Offline / local knowledgebase + deploy bilan <span class="pill">Developed by Mukhidov Firdavs</span></p>
      </div>
    </header>

    <main>
      <div class="chat" id="chat">
        <div class="messages" id="messages" aria-live="polite"></div>

        <div class="controls">
          <input id="userInput" type="text" placeholder="Savolingizni yozing... (masalan: 'isming nima', '12+5')" />
          <button id="sendBtn">Yuborish</button>
          <button id="clearBtn" class="ghost" title="Chatni tozalash">Tozalash</button>
        </div>
        <div class="hint" style="padding-top:8px">Yangi savollarni sidebar orqali qo ªshishingiz mumkin. Barchasi faqat sizning brauzeringizda saqlanadi.</div>
      </div>

      <aside>
        <div>
          <div class="section-title">Oldindan savollar (misollar)</div>
          <div class="qa-list" id="qaList"></div>

          <div style="margin-top:12px">
            <div class="section-title">Yangi savol ‚Üí javob qo ªshish</div>
            <label class="small">Savol (to ªliq yoki qisqasi)</label>
            <input id="newQ" type="text" placeholder="Masalan: Bugun ob-havo?" />
            <label class="small" style="margin-top:8px">Javob</label>
            <textarea id="newA" rows="3" placeholder="Masalan: Bugun quyoshli..."></textarea>

            <div class="footer-actions">
              <button id="addQA">Saqlash</button>
              <button id="resetQA" class="ghost">Barchasini o‚Äòchir</button>
            </div>
            <div class="hint">Qo ªshilgan savollar localStorage ºda saqlanadi. Ular sahifani qayta yuklaganda ham qoladi.</div>
          </div>
        </div>

        <div style="margin-top:14px">
          <div class="section-title">Sozlamalar & Deploy</div>
          <div class="small">HTTPS olish uchun quyidagilarni tanlang:</div>
          <ul class="small" style="padding-left:18px;margin-top:6px">
            <li>Netlify Drop ‚Äî faylni tortib tashlash (tez, avtomatik HTTPS)</li>
            <li>GitHub Pages ‚Äî repoga yuklab, Pages yoqing (https://USERNAME.github.io/REPO)</li>
          </ul>
          <div style="margin-top:8px;display:flex;gap:8px">
            <button id="netlifyGuide" class="ghost">Netlify qanday?</button>
            <button id="ghGuide" class="ghost">GitHub Pages qanday?</button>
          </div>
        </div>
      </aside>
    </main>
  </div>

<script>
(() => {
  /* ===== STORAGE KEYS ===== */
  const KB_KEY = 'mini_ai_kb_v2';
  const MSGS_KEY = 'mini_ai_msgs_v2';

  /* ===== DEFAULT KB ===== */
  const builtinKB = {
    "salom": "Salom! Qanday yordam bera olaman?",
    "isming nima": "Mening ismim MiniAI. Men oddiy offline chatbotman.",
    "kim yaratdi seni": "Siz yoki sizning developeringiz meni yaratdi ‚Äî siz ham meni o'zgartirishingiz mumkin.",
    "bugun sana": () => new Date().toLocaleDateString(),
    "soat necha": () => new Date().toLocaleTimeString(),
    "vaqt": () => new Date().toLocaleTimeString(),
    "sanani ayt": () => new Date().toLocaleDateString()
  };

  /* ===== DOM ===== */
  const MESSAGES = document.getElementById('messages');
  const USER_INPUT = document.getElementById('userInput');
  const SEND_BTN = document.getElementById('sendBtn');
  const CLEAR_BTN = document.getElementById('clearBtn');
  const QA_LIST = document.getElementById('qaList');
  const NEW_Q = document.getElementById('newQ');
  const NEW_A = document.getElementById('newA');
  const ADD_QA = document.getElementById('addQA');
  const RESET_QA = document.getElementById('resetQA');
  const NET_GUIDE = document.getElementById('netlifyGuide');
  const GH_GUIDE = document.getElementById('ghGuide');

  /* ===== UTIL ===== */
  function loadKB(){ try { return JSON.parse(localStorage.getItem(KB_KEY)) || {}; } catch(e){ return {}; } }
  function saveKB(kb){ try { localStorage.setItem(KB_KEY, JSON.stringify(kb)); } catch(e){} }
  function loadMsgs(){ try { return JSON.parse(localStorage.getItem(MSGS_KEY)) || []; } catch(e){ return []; } }
  function saveMsgs(ms){ try { localStorage.setItem(MSGS_KEY, JSON.stringify(ms)); } catch(e){} }

  function appendMessage(text, who='bot', save=true){
    const el = document.createElement('div');
    el.className = 'msg ' + (who === 'user' ? 'user' : 'bot');
    el.innerText = text;
    MESSAGES.appendChild(el);
    MESSAGES.scrollTop = MESSAGES.scrollHeight;
    if (save) {
      const msgs = loadMsgs();
      msgs.push({who,text,ts:Date.now()});
      saveMsgs(msgs);
    }
  }

  function renderQA(){
    QA_LIST.innerHTML = '';
    // builtins
    Object.keys(builtinKB).forEach(k => {
      const div = document.createElement('div');
      div.className = 'qa-item';
      const q = document.createElement('div'); q.className='q'; q.innerText = k;
      const a = document.createElement('div'); a.className='a'; a.innerText = (typeof builtinKB[k] === 'function' ? 'dynamic' : String(builtinKB[k]).slice(0,40));
      div.appendChild(q); div.appendChild(a);
      QA_LIST.appendChild(div);
    });
    // user
    const userKB = loadKB();
    Object.keys(userKB).forEach(k => {
      const div = document.createElement('div'); div.className='qa-item';
      const q = document.createElement('div'); q.className='q'; q.innerText = k;
      const a = document.createElement('div'); a.className='a'; a.innerText = userKB[k].slice(0,60);
      // add delete small button
      const del = document.createElement('button'); del.className='ghost'; del.style.padding='6px 8px'; del.innerText='O ªchirish';
      del.onclick = () => { if(confirm("Haqiqatan o'chirasizmi?")) { delete userKB[k]; saveKB(userKB); renderQA(); alert('O ªchirildi'); } };
      div.appendChild(q); div.appendChild(a); div.appendChild(del);
      QA_LIST.appendChild(div);
    });
  }

  /* ===== SAFE MATH EVAL ===== */
  function safeEvalMath(expr){
    // allow digits, spaces and operators + - * / ( ) . %
    const clean = expr.replace(/,/g,'').trim();
    if (!/^[0-9+\-*/(). %]+$/.test(clean)) return null;
    try {
      // new Function used intentionally, but with validated characters above
      const res = new Function('return ('+clean+')')();
      if (typeof res === 'number' && isFinite(res)) return res;
    } catch(e){}
    return null;
  }

  /* ===== FUZZY MATCH (very simple) ===== */
  function similarity(a,b){
    a=a.trim().toLowerCase(); b=b.trim().toLowerCase();
    if (!a || !b) return 0;
    if (a===b) return 1;
    // common substring ratio
    const la=a.length, lb=b.length;
    const min = Math.min(la,lb);
    let common=0;
    for (let i=0;i<min;i++){ if (a[i]===b[i]) common++; else break; }
    return (common/min) * 0.6; // prefix weight
  }

  /* ===== GET REPLY ===== */
  function getReply(text){
    const t = text.trim();
    if (!t) return "Iltimos, savol yozing.";
    const tl = t.toLowerCase();

    // 1) exact builtin
    if (builtinKB.hasOwnProperty(tl)) {
      const v = builtinKB[tl];
      return (typeof v === 'function') ? v() : v;
    }

    // 2) user KB exact
    const userKB = loadKB();
    if (userKB.hasOwnProperty(tl)) return userKB[tl];

    // 3) keywords
    if (/\b(soat|vaqt|time)\b/.test(tl)) return new Date().toLocaleTimeString();
    if (/\b(sana|bugun|date)\b/.test(tl)) return new Date().toLocaleDateString();
    if (/\b(ism|isming|who are you|what is your name)\b/.test(tl)) return "Men MiniAI ‚Äî oddiy lokal chatbotman.";

    // 4) math
    const math = safeEvalMath(tl);
    if (math !== null) return String(math);

    // 5) fuzzy try: find best key from userKB or builtinKB
    let best = {score:0,ans:null,key:null};
    for (const k of Object.keys(userKB)) {
      const s = similarity(tl,k);
      if (s > best.score) { best.score = s; best.ans = userKB[k]; best.key = k; }
    }
    for (const k of Object.keys(builtinKB)) {
      const s = similarity(tl,k);
      if (s > best.score) { best.score = s; best.ans = typeof builtinKB[k] === 'function' ? builtinKB[k]() : builtinKB[k]; best.key = k;}
    }
    if (best.score > 0.55) return best.ans + (best.key ? `\n(tegishli: "${best.key}")` : '');

    // 6) fallback suggestions
    const keys = Object.keys(userKB).slice(0,6);
    let fallback = "Kechirasiz, bu savol meni ortiqcha bilmaydi. Sidebar orqali javob qo'shishingiz mumkin.";
    if (keys.length) fallback += "\nSiz qo ªshgan misollar: " + keys.join(', ');
    return fallback;
  }

  /* ===== SEND & INTERACTIONS ===== */
  function send(){
    const txt = USER_INPUT.value.trim();
    if (!txt) return;
    appendMessage(txt,'user');
    USER_INPUT.value='';
    USER_INPUT.focus();
    // bot typing simulation
    appendMessage('Javob yozilmoqda...','bot', false);
    const last = MESSAGES.lastElementChild;
    setTimeout(() => {
      const reply = getReply(txt);
      last.innerText = reply;
      // save messages: remove temp and re-save all messages
      const msgs = [];
      document.querySelectorAll('.msg').forEach(n => msgs.push({who: n.classList.contains('user') ? 'user':'bot', text: n.innerText}));
      saveMsgs(msgs);
    }, 350);
  }

  SEND_BTN.addEventListener('click', send);
  USER_INPUT.addEventListener('keydown', e => { if (e.key === 'Enter') send(); });

  CLEAR_BTN.addEventListener('click', () => {
    if (!confirm('Chat tarixini tozalaymanmi?')) return;
    MESSAGES.innerHTML = '';
    localStorage.removeItem(MSGS_KEY);
    appendMessage("Salom! Men MiniAIman. Savolingizni yozing.");
  });

  /* ===== ADD QA ===== */
  ADD_QA.addEventListener('click', () => {
    const q = NEW_Q.value.trim();
    const a = NEW_A.value.trim();
    if (!q || !a) { alert('Iltimos, ham savol, ham javob kiriting.'); return; }
    const kb = loadKB();
    kb[q.toLowerCase()] = a;
    saveKB(kb);
    NEW_Q.value=''; NEW_A.value='';
    renderQA();
    alert('Saqlandi ‚Äî endi MiniAI shu savolga javob beradi!');
  });

  RESET_QA.addEventListener('click', () => {
    if (!confirm("Barcha qo ªshilgan savollar o'chadi. Davom etilsinmi?")) return;
    localStorage.removeItem(KB_KEY);
    renderQA();
    alert('Barchasi o‚Äòchirildi.');
  });

  /* ===== GUIDES ===== */
  NET_GUIDE.addEventListener('click', () => {
    alert("Netlify Drop: https://app.netlify.com/drop sahifasiga boring va index.html faylingizni arxivlamasdan torting. Netlify avtomatik HTTPS beradi.");
  });
  GH_GUIDE.addEventListener('click', () => {
    alert("GitHub Pages: GitHub repo yarating -> index.html yuklang -> Settings -> Pages -> Branch: main -> Save. URL: https://USERNAME.github.io/REPO (HTTPS avtomatik).");
  });

  /* ===== INIT UI ===== */
  function loadInitial(){
    renderQA();
    // load messages
    const msgs = loadMsgs();
    if (msgs.length) {
      msgs.forEach(m => appendMessage(m.text, m.who, false));
    } else {
      appendMessage("Salom! Men MiniAIman. Savolingizni yozing.", 'bot', false);
    }
  }
  loadInitial();

  // accessibility: focus input
  USER_INPUT.focus();

})();
</script>
</body>
</html>
